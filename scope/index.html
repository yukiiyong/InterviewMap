<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JavaScript运行原理 | InterviewMap</title>
    <meta name="generator" content="VuePress 1.5.3">
    
    <meta name="description" content="一些知识点汇总">
    <link rel="preload" href="/InterviewMap/assets/css/0.styles.f8f27b20.css" as="style"><link rel="preload" href="/InterviewMap/assets/js/app.7ef33b20.js" as="script"><link rel="preload" href="/InterviewMap/assets/js/2.c7a96f3a.js" as="script"><link rel="preload" href="/InterviewMap/assets/js/5.4c15f03b.js" as="script"><link rel="prefetch" href="/InterviewMap/assets/js/10.0f9db2d8.js"><link rel="prefetch" href="/InterviewMap/assets/js/11.599fcd1d.js"><link rel="prefetch" href="/InterviewMap/assets/js/12.48698b7d.js"><link rel="prefetch" href="/InterviewMap/assets/js/13.0f44793a.js"><link rel="prefetch" href="/InterviewMap/assets/js/14.f6835b44.js"><link rel="prefetch" href="/InterviewMap/assets/js/15.246434a8.js"><link rel="prefetch" href="/InterviewMap/assets/js/16.1bbb01e8.js"><link rel="prefetch" href="/InterviewMap/assets/js/17.fb33cca3.js"><link rel="prefetch" href="/InterviewMap/assets/js/18.38361e45.js"><link rel="prefetch" href="/InterviewMap/assets/js/19.ceedfd89.js"><link rel="prefetch" href="/InterviewMap/assets/js/20.49b80d6a.js"><link rel="prefetch" href="/InterviewMap/assets/js/21.f1aca8c3.js"><link rel="prefetch" href="/InterviewMap/assets/js/22.c985210e.js"><link rel="prefetch" href="/InterviewMap/assets/js/23.9ea95266.js"><link rel="prefetch" href="/InterviewMap/assets/js/24.fdfbf9f3.js"><link rel="prefetch" href="/InterviewMap/assets/js/25.5b4ed8a5.js"><link rel="prefetch" href="/InterviewMap/assets/js/26.e1c64e30.js"><link rel="prefetch" href="/InterviewMap/assets/js/27.376d4e22.js"><link rel="prefetch" href="/InterviewMap/assets/js/28.73c85acd.js"><link rel="prefetch" href="/InterviewMap/assets/js/29.00c39ca9.js"><link rel="prefetch" href="/InterviewMap/assets/js/3.77ff65da.js"><link rel="prefetch" href="/InterviewMap/assets/js/4.21e61ed5.js"><link rel="prefetch" href="/InterviewMap/assets/js/6.7533068f.js"><link rel="prefetch" href="/InterviewMap/assets/js/7.6c4ade9d.js"><link rel="prefetch" href="/InterviewMap/assets/js/8.24677f8d.js"><link rel="prefetch" href="/InterviewMap/assets/js/9.452aed5a.js">
    <link rel="stylesheet" href="/InterviewMap/assets/css/0.styles.f8f27b20.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/InterviewMap/" class="home-link router-link-active"><!----> <span class="site-name">InterviewMap</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>js</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/InterviewMap/ajax/" class="sidebar-link">Ajax</a></li><li><a href="/InterviewMap/this/" class="sidebar-link">this的绑定规则</a></li><li><a href="/InterviewMap/scope/" aria-current="page" class="active sidebar-link">JavaScript运行原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/InterviewMap/scope/#javascript运行原理" class="sidebar-link">JavaScript运行原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/InterviewMap/scope/#引擎对js的处理流程（语法检查）" class="sidebar-link">引擎对JS的处理流程（语法检查）</a></li><li class="sidebar-sub-header"><a href="/InterviewMap/scope/#javascript预解析阶段" class="sidebar-link">JavaScript预解析阶段</a></li><li class="sidebar-sub-header"><a href="/InterviewMap/scope/#分号补全规则" class="sidebar-link">分号补全规则</a></li></ul></li><li class="sidebar-sub-header"><a href="/InterviewMap/scope/#执行上下文栈" class="sidebar-link">执行上下文栈</a></li><li class="sidebar-sub-header"><a href="/InterviewMap/scope/#执行上下文" class="sidebar-link">执行上下文</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/InterviewMap/scope/#this" class="sidebar-link">this</a></li><li class="sidebar-sub-header"><a href="/InterviewMap/scope/#变量对象vo" class="sidebar-link">变量对象VO</a></li><li class="sidebar-sub-header"><a href="/InterviewMap/scope/#全局对象" class="sidebar-link">全局对象</a></li><li class="sidebar-sub-header"><a href="/InterviewMap/scope/#函数执行流程" class="sidebar-link">函数执行流程</a></li><li class="sidebar-sub-header"><a href="/InterviewMap/scope/#函数的上下文变量对象" class="sidebar-link">函数的上下文变量对象</a></li><li class="sidebar-sub-header"><a href="/InterviewMap/scope/#变量对象优先级问题" class="sidebar-link">变量对象优先级问题</a></li><li class="sidebar-sub-header"><a href="/InterviewMap/scope/#活动对象ao" class="sidebar-link">活动对象AO</a></li><li class="sidebar-sub-header"><a href="/InterviewMap/scope/#作用域" class="sidebar-link">作用域</a></li><li class="sidebar-sub-header"><a href="/InterviewMap/scope/#作用域链" class="sidebar-link">作用域链</a></li><li class="sidebar-sub-header"><a href="/InterviewMap/scope/#在作用域链查找变量" class="sidebar-link">在作用域链查找变量</a></li></ul></li></ul></li><li><a href="/InterviewMap/arr/" class="sidebar-link">查找字符串中字符的个数</a></li><li><a href="/InterviewMap/emitter/" class="sidebar-link">微内核 包括核心模块和插件模块</a></li><li><a href="/InterviewMap/date/" class="sidebar-link">Date</a></li><li><a href="/InterviewMap/promise/" class="sidebar-link">promise</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>module</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>js</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="javascript运行原理"><a href="#javascript运行原理" class="header-anchor">#</a> JavaScript运行原理</h2> <ol><li>JavaScript是解释性语言，无需提前编译，由解释器实时运行</li> <li>JavaScript的程序执行主要分为语法检查和执行两个阶段。</li> <li>语法检查包括词法分析，语法分析等，目的是将JS代码转换为抽象语法树，从而转换为字节码和机器码。</li> <li>执行阶段分为预解析和执行阶段。</li> <li>预解析阶段会创建执行上下文，将语法检查后生成的抽象语法树复制到当前的执行上下文，做属性填充，对抽象语法树中的变量声明、函数声明以及函数的形参作属性的填充。</li></ol> <h3 id="引擎对js的处理流程（语法检查）"><a href="#引擎对js的处理流程（语法检查）" class="header-anchor">#</a> 引擎对JS的处理流程（语法检查）</h3> <ol><li>读取代码，对代码进行词法分析（lexical analysis），然后将代码分解成词元</li> <li>将词元进行语法分析，然后将代码整理成语法树（syntax tree）</li> <li>使用翻译器，将代码转换成字节码（bytecode）</li> <li>将字节码用字节码解释器转成机器码，然后等待计算机执行</li></ol> <blockquote><p>为了提高运行速度，浏览器一般采用即时编译，即字节码只在运行时编译，用到哪一行编译哪一行，且把编译结果缓存。</p></blockquote> <blockquote><p>JS是弱类型，只在运行时检查数据类型</p></blockquote> <h3 id="javascript预解析阶段"><a href="#javascript预解析阶段" class="header-anchor">#</a> JavaScript预解析阶段</h3> <ol><li>分号补全</li> <li>变量提升：变量声明、函数声明</li> <li>创建执行上下文</li></ol> <blockquote><p>预解析只发生在当前作用域下 ，即只有函数执行时才会对函数里的变量和函数进行预解析</p></blockquote> <h3 id="分号补全规则"><a href="#分号补全规则" class="header-anchor">#</a> 分号补全规则</h3> <ol><li>当有换行符（且含有换行符的多行注释），并且下一个token无法与前面的语法匹配时，自动补分号。</li> <li>当有'}'时，自动补分号</li> <li>程序源代码结束时，自动补分号</li></ol> <h2 id="执行上下文栈"><a href="#执行上下文栈" class="header-anchor">#</a> 执行上下文栈</h2> <p>在JavaScript解释器运行阶段（预解析）维护了一个栈，用于管理执行上下文</p> <ol><li>浏览器首次访问脚本，将创建全局上下文，并压入栈顶（浏览器关闭前不可弹出），此时进行全局代码的初始化，即进行变量声明和函数声明</li> <li>全局上下文代码执行时可能会遇到函数，执行函数的时候会创建函数上下文并压入栈顶，然后创建对应的作用域</li> <li>一旦上下文执行完毕，就会从栈顶弹出，并将上下文控制权交还给当前栈</li> <li>依次执行，最终回到全局执行上下文</li></ol> <blockquote><p>程序执行完毕，则会被弹出栈顶，若无闭包（变量或函数被引用），则这个函数的内存会被垃圾回收器回收</p></blockquote> <blockquote><p>激活其他执行上下文的某执行上下文被称为调用者（caller），被激活的执行上下文被称为被调用者（callee），一个执行上下文即可能是调用者也可能是被调用者
当一个caller激活了一个callee时，caller会暂停自身执行，将控制权交给callee，此时callee被放进执行上下文栈，被称为进行中的上下文。当这个callee上下文结束后，将控制权交还给它的caller，caller会在刚才暂停的地方继续执行。在这个caller结束后，会继续触发其他的上下文</p></blockquote> <p><img src="/InterviewMap/assets/img/scope_chain.efcfcd49.png" alt="执行上下文栈"></p> <h2 id="执行上下文"><a href="#执行上下文" class="header-anchor">#</a> 执行上下文</h2> <p>执行上下文可以理解成代码执行时的环境，是一个抽象概念。当执行一段可执行代码时，都会创建对应的执行上下文
执行上下文包含三个属性，即变量对象（VO），作用域链和this</p> <div class="language- extra-class"><pre class="language-text"><code>executionContext: {
  variable object: vars,function, arguments,
  scope chains: variable objects + all parents scopes,
  thisValue: context object
}
</code></pre></div><h3 id="this"><a href="#this" class="header-anchor">#</a> this</h3> <p>this是执行上下文的一个属性，值从上下文中获得，取决于进入上下文的情况</p> <h3 id="变量对象vo"><a href="#变量对象vo" class="header-anchor">#</a> 变量对象VO</h3> <div class="language- extra-class"><pre><code>变量对象时执行上下文的一个属性，存放一些变量信息，例如声明的变量、声明的函数，arguments（形参数组）等
只有全局上下文的变量对象可以通过VO的属性名称间接访问，因为全局上下文中，变量对象就是全局对象，其他上下文不能通过VO的属性名称间接访问变量对象
</code></pre></div><h3 id="全局对象"><a href="#全局对象" class="header-anchor">#</a> 全局对象</h3> <ol><li>全局对象在程序初始化的时候创建，这个对象只存在一份，它的属性在程序的任何地方都可以访问，全局对象的生命周期终止于程序退出的那一刻</li> <li>全局对象创建阶段将Math、String、Date、parseInt等预置属性作为自身属性，同时还可以吧其他对象作为（额外的）属性</li> <li>在DOM中，可以通过全局对象的window属性来访问全局对象自身</li> <li>可以通过全局上下文的this来访问全局对象，同样可以递归自身</li> <li>当访问全局对象的属性时通常会忽略掉前缀，但全局对象不可以通过名称直接访问</li> <li>全局对象存储着全局范围内定义的变量和函数声明</li></ol> <h3 id="函数执行流程"><a href="#函数执行流程" class="header-anchor">#</a> 函数执行流程</h3> <ol><li>若有形参，给形参赋值</li> <li>进行私有（函数）作用域的预解析</li> <li>私有（函数）作用域的代码自上而下执行</li></ol> <h3 id="函数的上下文变量对象"><a href="#函数的上下文变量对象" class="header-anchor">#</a> 函数的上下文变量对象</h3> <p>进入函数的执行上下文时，函数的变量对象（VO）被以下属性填充</p> <ol><li>形参， 属性名为参数名，值为实参的值，若无传递，则其值为undefined</li> <li>函数声明，由名称和对应值组成变量对象的属性被创建，若变量对象中已经存在相应值，则只替换</li> <li>变量声明，通过var声明的，在VO中的值为undefined，若VO中存在相同的属性，则不会影响到已存在的属性</li></ol> <h3 id="变量对象优先级问题"><a href="#变量对象优先级问题" class="header-anchor">#</a> 变量对象优先级问题</h3> <ol><li>变量和函数重名时，函数的优先级高于变量（包括形参）<br>
2.函数声明在var声明之上，优先级高</li> <li>函数执行时，函数内部才预解析，预解析自上而下，并不包括函数内部代码</li> <li>预解析时先给实参赋值在进入函数内部</li> <li>未使用var、let、const 声明的变量都是全局变量</li></ol> <h3 id="活动对象ao"><a href="#活动对象ao" class="header-anchor">#</a> 活动对象AO</h3> <p>创建函数上下文阶段，变量对象被创建，但此时变量对象的属性不能被访问。只有当函数执行时，变量对象被激活，变成了活动对象。此时变量对象的属性可以被访问，进入执行阶段的操作。</p> <h3 id="作用域"><a href="#作用域" class="header-anchor">#</a> 作用域</h3> <ol><li>程序初始化时会形成全局作用域，在此期间声明的变量和函数是全局变量</li> <li>函数执行时会形成函数作用域，函数作用域里声明的变量和函数属于函数的私有变量，外部不可访问</li></ol> <h3 id="作用域链"><a href="#作用域链" class="header-anchor">#</a> 作用域链</h3> <div class="language- extra-class"><pre><code>作用域链是执行上下文的一个属性，原理与原型链类似
作用域链包含当前作用域的变量对象（VO）和所有的父级作用域链
</code></pre></div><h3 id="在作用域链查找变量"><a href="#在作用域链查找变量" class="header-anchor">#</a> 在作用域链查找变量</h3> <ol><li>代码执行的时候遇到一个变量foo，首先确定它是否当前作用域里的私有变量，若是则在当前作用域的变量对象（VO）里查找</li> <li>若不是私有变量，则去它的父级作用域(<em>parent</em>)查找</li> <li>若父级作用域中不存在此变量，则沿着作用域链向上查找</li> <li>直到全局上下文也没找到则报错</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/InterviewMap/this/" class="prev">
        this的绑定规则
      </a></span> <span class="next"><a href="/InterviewMap/arr/">
        查找字符串中字符的个数
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/InterviewMap/assets/js/app.7ef33b20.js" defer></script><script src="/InterviewMap/assets/js/2.c7a96f3a.js" defer></script><script src="/InterviewMap/assets/js/5.4c15f03b.js" defer></script>
  </body>
</html>
