(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{360:function(e,t,r){"use strict";r.r(t);var a=r(42),i=Object(a.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h4",{attrs:{id:"前端监控性能监控和错误监控"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#前端监控性能监控和错误监控"}},[e._v("#")]),e._v(" 前端监控性能监控和错误监控")]),e._v(" "),r("ul",[r("li",[e._v("其中监控又分为两个环节： 数据采集和错误上报")]),e._v(" "),r("li",[e._v("性能数据采集 需要用到windows.performance.timing API 这个API包含了页面加载的各个阶段的起始和结束时间")])]),e._v(" "),r("h4",{attrs:{id:"耗时"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#耗时"}},[e._v("#")]),e._v(" 耗时")]),e._v(" "),r("ul",[r("li",[e._v("重定向耗时： redirect: timing.redirectEnd - timing.redirectStart")]),e._v(" "),r("li",[e._v("DOM渲染耗时   dom : timing.domComplect - timing.domLoading")]),e._v(" "),r("li",[e._v("页面加载耗时   load :  timing.loadEventEnd - timing.loadEventStart")]),e._v(" "),r("li",[e._v("页面卸载耗时   unload :  timing.unloadEventEnd - timing.unloadEventStart")]),e._v(" "),r("li",[e._v("请求耗时 request : timing.responseEnd - timing.requestStart")]),e._v(" "),r("li",[e._v("获取性能信息时当前时间    time : new Date().getTime()")])]),e._v(" "),r("h4",{attrs:{id:"白屏时间"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#白屏时间"}},[e._v("#")]),e._v(" 白屏时间")]),e._v(" "),r("blockquote",[r("p",[e._v("指从输入网址到页面开始显示内容到时间")])]),e._v(" "),r("ul",[r("li",[e._v("以下脚本放在head 标签前就可以获取白屏时间"),r("br"),e._v(" "),r("code",[e._v("whiteScreen＝ new Date().getTime() - performance.timing.navigationStart")])])]),e._v(" "),r("p",[r("strong",[e._v("白屏时间2")]),e._v(" "),r("code",[e._v("whiteScreen = performance.timing.domLoading - performance.timing.navigationStart")])]),e._v(" "),r("h4",{attrs:{id:"获取资源消耗的时间"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#获取资源消耗的时间"}},[e._v("#")]),e._v(" 获取资源消耗的时间")]),e._v(" "),r("ul",[r("li",[e._v("通过Windows.performance.getEntriesByType('resource')这个方法可以获得相关资源(js,css,img...)的加载时间，它会返回页面当前所加载的所有资源的加载时间")]),e._v(" "),r("li",[e._v("它一般包括一下几个类型： link，css，other，xmlHttpRequest，script，img，fetch")]),e._v(" "),r("li",[e._v("页面加载慢的原因： 资源过大，过多，网速过慢，dom元素过多")])]),e._v(" "),r("h4",{attrs:{id:"错误信息采集："}},[r("a",{staticClass:"header-anchor",attrs:{href:"#错误信息采集："}},[e._v("#")]),e._v(" 错误信息采集：")]),e._v(" "),r("blockquote",[r("p",[e._v("资源加载错误，js执行错误，promise错误")])]),e._v(" "),r("ol",[r("li",[e._v("资源加载错误 通过window.addEventListener('error',callback, true) 在捕获阶段捕捉资源加载失败错误")]),e._v(" "),r("li",[e._v("js执行错误 通过window.onerror() 捕捉js错误")]),e._v(" "),r("li",[e._v("promise错误 通过window.addEventListener('unhandledrejection',callback) 捕捉promise错误，但是没有行数和列数，只能手动抛出错误信息")]),e._v(" "),r("li",[e._v("vue 经过转换后的代码（cheap-module-eval-source-map）不能通过window.onerror捕获（可以捕获js内部错误？手动抛出错误捕获不了），只能通过Vue.config.errorHandler捕获")])]),e._v(" "),r("blockquote",[r("p",[e._v("JS异常需要将devtool改为'source-map'才能捕获异常信息。原先的devtool为cheap-module-eval-source-map,代码是经过vue转换的代码，所以无法捕捉到JS异常")])]),e._v(" "),r("h4",{attrs:{id:"数据上报"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#数据上报"}},[e._v("#")]),e._v(" 数据上报")]),e._v(" "),r("ul",[r("li",[e._v("尽量在浏览器页面加载完之后上报。即"),r("code",[e._v("window.onLoad")]),e._v("之后上报")]),e._v(" "),r("li",[e._v("可以利用"),r("code",[e._v("window.requestIdleCallback")]),e._v("在浏览器空闲时上报")])]),e._v(" "),r("h4",{attrs:{id:"错误上报"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#错误上报"}},[e._v("#")]),e._v(" 错误上报")]),e._v(" "),r("p",[e._v("用一个数组errors来记录发生过的错误信息。")]),e._v(" "),r("ol",[r("li",[e._v("在某一阶段统一上报（延时上报）")]),e._v(" "),r("li",[e._v("使用navigator.sendBeacon（）")])]),e._v(" "),r("blockquote",[r("p",[e._v("使用beacon方法会使用户代理（即浏览器）在有机会时异步地向服务器发送数据，同时不会延误页面的卸载荷下一个导航的载入性能，这就解决了提交分析数据时的所有问题：数据可靠，传输异步且不会影响下一个页面的加载")])]),e._v(" "),r("h4",{attrs:{id:"spa"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#spa"}},[e._v("#")]),e._v(" SPA")]),e._v(" "),r("ul",[r("li",[e._v("在SPA切换路由时，window.performance不会更新。所以我们要"),r("strong",[e._v("手动计算切换路由到页面加载完毕的时间")])]),e._v(" "),r("li",[e._v("可以使用路由前置守卫函数"),r("strong",[e._v("beforeEach获取开始切换路由的时间")]),e._v("，在组件的"),r("strong",[e._v("mounted里执行vm.$nextTick函数来获取组件渲染完毕的时间")])])])])}),[],!1,null,null,null);t.default=i.exports}}]);